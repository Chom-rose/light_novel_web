<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>‡∏ï‡∏±‡∏ß‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢</title>
<link rel="stylesheet" href="/css/write.css" />
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
<header>
  <div class="topbar">
    <div class="title">‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</div>
    <div class="actions">
      <button class="btn" id="btnDraft">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á</button>
      <button class="btn primary" id="btnPublish">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà</button>
    </div>
  </div>
</header>

<div class="wrap">
  <!-- LEFT -->
  <aside class="side">
    <div class="head">
      ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏≤‡∏ß 
    </div>
    <div class="tabs">
      <div class="tab active" id="tabCh">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
    </div>

    <!-- chapter list -->
    <div class="list" id="chapterList"></div>
    <div class="addrow"><button class="addbtn" id="addChapter">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏≠‡∏ô</button></div>
  </aside>

  <!-- RIGHT -->
  <section class="main">
    <h1 class="novel-title" id="novelName" contenteditable="true">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</h1>
    <input id="chapterTitle" class="chapter-title" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≠‡∏ô" />
    <div class="toolbar">
      <button class="tbtn" data-cmd="bold"><b>B</b></button>
      <button class="tbtn" data-cmd="italic"><i>I</i></button>
      <button class="tbtn" data-cmd="underline"><u>U</u></button>
      <button class="tbtn" data-cmd="insertUnorderedList">‚Ä¢ List</button>
      <button class="tbtn" data-cmd="insertOrderedList">1. List</button>
      <button class="tbtn" id="btnH1">‡∏´‡∏±‡∏ß‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</button>
      <button class="tbtn" id="btnQuote">‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á</button>
    </div>
    <div id="editor" class="editor" contenteditable="true" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ"></div>
  </section>
</div>

<script>
/* --- dummy store in localStorage --- */
const KEY = "novel-editor-demo";
const state = JSON.parse(localStorage.getItem(KEY) || `{
  "novelName":"‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á",
  "chapters":[
    {"id":"c1","name":"‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1","content":"<p>‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1</p>"},
    {"id":"c2","name":"‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2","content":""},
    {"id":"c3","name":"‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3","content":""}
  ],
  "active":"c1"
}`);

const title = document.getElementById("novelName");

  // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ
  title.textContent = localStorage.getItem("novelName") || title.textContent;

  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
  title.addEventListener("input", () => {
    localStorage.setItem("novelName", title.textContent);
  });

const els = {
  list: document.getElementById('chapterList'),
  title: document.getElementById('chapterTitle'),
  editor: document.getElementById('editor'),
  novelName: document.getElementById('novelName'),
  add: document.getElementById('addChapter'),
  btnDraft: document.getElementById('btnDraft'),
  btnPublish: document.getElementById('btnPublish')
};

function saveLocal() {
  localStorage.setItem(KEY, JSON.stringify(state));
}

function renderList() {
  els.list.innerHTML = "";
  state.chapters.forEach((ch, idx) => {
    const row = document.createElement('div');
    row.className = 'chapter' + (ch.id === state.active ? ' active':'');
    row.onclick = () => activate(ch.id);
    row.innerHTML = `
      <div class="ch-num">#${idx+1}</div>
      <div class="ch-name" title="${ch.name}">${ch.name || "‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠"}</div>
      <div class="tools">
        <button class="ghost" title="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠" onclick="event.stopPropagation(); renameChapter('${ch.id}')">‚úé</button>
        <button class="ghost" title="‡∏•‡∏ö" onclick="event.stopPropagation(); deleteChapter('${ch.id}')">üóë</button>
      </div>`;
    els.list.appendChild(row);
  });
}

function activate(id){
  const ch = state.chapters.find(c=>c.id===id);
  state.active = id;
  els.title.value = ch.name || "";
  els.editor.innerHTML = ch.content || "";
  renderList();
  saveLocal();
}

function renameChapter(id){
  const ch = state.chapters.find(c=>c.id===id);
  const name = prompt("‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≠‡∏ô", ch.name || "");
  if(name!==null){ ch.name = name.trim(); saveLocal(); renderList(); if(id===state.active) els.title.value = ch.name; }
}

function deleteChapter(id){
  if(!confirm("‡∏•‡∏ö‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ?")) return;
  const i = state.chapters.findIndex(c=>c.id===id);
  if(i>-1){ state.chapters.splice(i,1); if(state.active===id && state.chapters[0]) state.active = state.chapters[0].id; saveLocal(); renderList(); activate(state.active); }
}

els.add.onclick = () => {
  const nid = 'c'+Math.random().toString(36).slice(2,7);
  state.chapters.push({id:nid,name:"‡∏ï‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà",content:""});
  saveLocal(); renderList(); activate(nid);
};

els.title.addEventListener('input', () => {
  const ch = state.chapters.find(c=>c.id===state.active);
  ch.name = els.title.value;
  renderList(); saveLocal();
});

function autoSave() {
  const ch = state.chapters.find(c=>c.id===state.active);
  ch.content = els.editor.innerHTML;
  saveLocal();
}
setInterval(autoSave, 3000);

document.querySelectorAll('[data-cmd]').forEach(b=>{
  b.onclick = ()=> document.execCommand(b.dataset.cmd,false,null);
});
document.getElementById('btnH1').onclick = ()=> document.execCommand('formatBlock', false, 'h2');
document.getElementById('btnQuote').onclick = ()=> document.execCommand('formatBlock', false, 'blockquote');

els.btnDraft.onclick = ()=> { autoSave(); alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß (localStorage)'); };
els.btnPublish.onclick = ()=> { autoSave(); alert('‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡πÄ‡∏î‡πÇ‡∏°: ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ backend ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì'); };

window.addEventListener('load', ()=>{
  els.novelName.textContent = state.novelName;
  renderList();
  activate(state.active || state.chapters[0].id);
});
 const novelName = document.getElementById("novelName");

  // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
  const savedTitle = localStorage.getItem("novelName");
  if (savedTitle) {
    novelName.textContent = savedTitle;
  }

  // ‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç h1 ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage
  novelName.addEventListener("input", () => {
    localStorage.setItem("novelName", novelName.textContent.trim());
  });
</script>
</body>
</html>
