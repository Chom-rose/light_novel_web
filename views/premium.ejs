<%- include('includes/head') %>
</head>
<body class="bg-gray-100">
  <%- include('includes/nav') %>

  <main class="max-w-3xl mx-auto py-12">
    <div class="bg-white p-8 rounded-xl shadow text-center">
      <h1 class="text-2xl font-bold mb-6">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å Premium</h1>
      <p class="mb-4">‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô 99 ‡∏ö‡∏≤‡∏ó</p>

      <div id="qrBox" class="my-6">
        <!-- ‡∏£‡∏π‡∏õ QR ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JS -->
      </div>

      <button id="checkStatus" 
        class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700">
        ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
      </button>

      <div id="statusMsg" class="mt-4 text-sm text-gray-600"></div>
    </div>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const token = localStorage.getItem("token");
      if (!token) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô");
        window.location.href = "/login";
        return;
      }

      // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á QR
      const res = await fetch("/payment/start", {
        method: "POST",
        headers: { "Authorization": "Bearer " + token }
      });
      const data = await res.json();
      if (data.qrImage) {
        document.getElementById("qrBox").innerHTML = `
          <img src="${data.qrImage}" class="mx-auto w-64 h-64 border rounded-lg">
        `;
      }

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
      document.getElementById("checkStatus").addEventListener("click", async () => {
        const meRes = await fetch("/auth/me", {
          headers: { "Authorization": "Bearer " + token }
        });
        const meData = await meRes.json();
        if (meData.user?.is_premium === 1) {
          document.getElementById("statusMsg").innerHTML =
            `<span class="text-green-600 font-semibold">‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô Premium ‡πÅ‡∏•‡πâ‡∏ß üéâ</span>`;
        } else {
          document.getElementById("statusMsg").innerHTML =
            `<span class="text-red-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô Premium</span>`;
        }
      });
    });
  </script>
  <script src="/js/main.js"></script>
</body>
</html>