<!DOCTYPE html>
<html lang="th">
<head>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>หน้าหลัก</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
  <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"/>
  <link rel="stylesheet" href="/css/main.css">
</head>
<body class="bg-zinc-50">
  <header class="bg-white border-b">
    <nav class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <a href="/light-novel" class="font-bold text-xl">logo</a>
        <a href="/light-novel" class="hover:underline">นิยาย</a>
        <a href="/light-novel/create" class="hover:underline">สร้างผลงาน</a>
      </div>
      <div class="flex items-center gap-3">
        <a href="/light-novel/create" class="px-3 py-1.5 bg-indigo-600 text-white rounded-md">+ สร้างนิยาย</a>
        <div class="px-3 py-1.5 bg-zinc-100 rounded-md">user</div>
      </div>
    </nav>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-8">
    <section class="mb-10">
      <h2 class="text-xl font-bold mb-4">นิยายยอดนิยม</h2>
      <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="top-swiper">
          <!-- dynamic slides -->
        </div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-pagination"></div>
      </div>
    </section>

    <section class="mb-10">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold">นิยายมาใหม่</h3>
        <a href="#" class="text-sm text-indigo-600 hover:underline" id="see-all-link">ดูทั้งหมด</a>
      </div>
      <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4" id="latest-grid"></div>
    </section>
  </main>


  <footer class="bg-white border-t">
    <div class="max-w-7xl mx-auto px-4 py-6 text-center text-sm text-zinc-500">
      &copy; 2025 cat fat. สงวนลิขสิทธิ์.
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script>
    async function loadNovels() {
      try {
        const res = await fetch('/light-novel/api/novels');
        if (!res.ok) throw new Error('Fetch failed');
        const novels = await res.json();

        // Swiper slides
        const swiperWrap = document.getElementById('top-swiper');
        swiperWrap.innerHTML = novels.slice(0, 5).map(n => `
          <div class="swiper-slide">
            <div class="relative">
              <img src="${n.coverImage}" class="w-full h-64 object-cover rounded-xl" alt="${n.name}">
              <div class="absolute bottom-3 left-3 bg-black/60 text-white px-3 py-1 rounded-lg">${n.name}</div>
            </div>
          </div>`).join('');

        new Swiper('.mySwiper', {
          loop: true,
          autoplay: { delay: 3000, disableOnInteraction: false },
          pagination: { el: '.swiper-pagination', clickable: true },
          navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' }
        });

        // Latest grid
        const grid = document.getElementById('latest-grid');
        grid.innerHTML = novels.slice(-10).reverse().map(n => `
          <article class="bg-white rounded-xl shadow p-2">
            <img src="${n.coverImage}" alt="" class="rounded-lg w-full h-48 object-cover">
            <h4 class="font-semibold mt-2 truncate" title="${n.name}">${n.name}</h4>
            <p class="text-sm text-zinc-500">${n.author}</p>
            <a href="/light-novel/novel?id=${n.id}" class="mt-2 inline-block text-indigo-600 text-sm">อ่านเลย →</a>
          </article>`).join('');

        // Scroll to grid
        document.getElementById('see-all-link').addEventListener('click', (e) => {
          e.preventDefault();
          window.scrollTo({ top: document.getElementById('latest-grid').offsetTop - 60, behavior: 'smooth' });
        });
      } catch (err) {
        console.error(err);
        // เผื่อไม่มีข้อมูล/เออเรอร์
        document.getElementById('top-swiper').innerHTML = `
          <div class="swiper-slide">
            <div class="p-6 text-center text-zinc-500">โหลดข้อมูลไม่สำเร็จ</div>
          </div>`;
      }
    }

    loadNovels();
  </script>

</body>
</html>

